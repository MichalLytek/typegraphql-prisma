"use strict";(self.webpackChunktypegraphql_prisma_website=self.webpackChunktypegraphql_prisma_website||[]).push([[242],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>c});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),p=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=p(e.components);return r.createElement(l.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=p(t),c=a,g=d["".concat(l,".").concat(c)]||d[c]||m[c]||s;return t?r.createElement(g,i(i({ref:n},u),{},{components:t})):r.createElement(g,i({ref:n},u))}));function c(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,i=new Array(s);i[0]=d;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var p=2;p<s;p++)i[p]=t[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},6067:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var r=t(7462),a=(t(7294),t(3905));const s={title:"Usage",sidebar_position:3},i=void 0,o={unversionedId:"basics/usage",id:"basics/usage",title:"Usage",description:"Having installed all the deps and configured the Prisma generator, let's see the capabilities of typegraphql-prisma.",source:"@site/../docs/basics/usage.md",sourceDirName:"basics",slug:"/basics/usage",permalink:"/docs/basics/usage",draft:!1,editUrl:"https://github.com/MichalLytek/typegraphql-prisma/edit/main/docs/../docs/basics/usage.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Usage",sidebar_position:3},sidebar:"docs",previous:{title:"Configuration",permalink:"/docs/basics/configuration"},next:{title:"Prisma version check",permalink:"/docs/basics/prisma-version"}},l={},p=[{value:"Showcase",id:"showcase",level:2},{value:"CRUD resolvers",id:"crud-resolvers",level:2},{value:"Relations resolvers",id:"relations-resolvers",level:2},{value:"Bootstrapping",id:"bootstrapping",level:2},{value:"Context configuration",id:"context-configuration",level:2}],u={toc:p};function m(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Having installed all the deps and configured the Prisma generator, let's see the capabilities of ",(0,a.kt)("inlineCode",{parentName:"p"},"typegraphql-prisma"),"."),(0,a.kt)("h2",{id:"showcase"},"Showcase"),(0,a.kt)("p",null,"Let's assume you have this statements in your Prisma schema:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-prisma",metastring:"title=prisma/schema.prisma",title:"prisma/schema.prisma"},"enum UserKind {\n  NORMAL\n  ADMIN\n}\n\nmodel User {\n  id    String  @default(cuid()) @id @unique\n  email String  @unique\n  age   Int?\n  kind  UserKind\n}\n")),(0,a.kt)("p",null,"It will generate a ",(0,a.kt)("inlineCode",{parentName:"p"},"User")," class (with TypeGraphQL decorators) in the output folder and an enum:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=generated/type-graphql/enums/UserKind.ts",title:"generated/type-graphql/enums/UserKind.ts"},'export enum UserKind {\n  NORMAL = "NORMAL",\n  ADMIN = "ADMIN",\n}\nTypeGraphQL.registerEnumType(UserKind, {\n  name: "UserKind",\n  description: undefined,\n});\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=generated/type-graphql/models/User.ts",title:"generated/type-graphql/models/User.ts"},"@TypeGraphQL.ObjectType({\n  description: undefined,\n})\nexport class User {\n  @TypeGraphQL.Field(_type => String, {\n    nullable: false,\n    description: undefined,\n  })\n  id!: string;\n\n  @TypeGraphQL.Field(_type => String, {\n    nullable: false,\n    description: undefined,\n  })\n  email!: string;\n\n  @TypeGraphQL.Field(_type => Int, {\n    nullable: true,\n    description: undefined,\n  })\n  age?: number | null;\n\n  @TypeGraphQL.Field(_type => UserKind, {\n    nullable: false,\n    description: undefined,\n  })\n  kind!: UserKind;\n}\n")),(0,a.kt)("p",null,"You can import them and use normally as a type or an explicit type in your resolvers, e.g:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=src/custom-resolver.ts",title:"src/custom-resolver.ts"},'import {\n  User,\n  UserWhereUniqueInput,\n  UserKind,\n} from "../generated/type-graphql";\n\n@Resolver()\nclass CustomUserResolver {\n  @Mutation(() => User)\n  changeUserKind(\n    @Arg("where") where: UserWhereUniqueInput,\n    @Arg("kind") kind: UserKind,\n  ) {\n    log.info("Changing user kind", { where, kind });\n    return prisma.user.update({ where, data: { kind } });\n  }\n}\n')),(0,a.kt)("p",null,"However, it will also generates a whole bunch of stuffs based on your ",(0,a.kt)("inlineCode",{parentName:"p"},"schema.prisma")," file - not only models classes and enums but also input types, arguments, CRUD resolvers and relations resolver."),(0,a.kt)("admonition",{title:"Main concept",type:"note"},(0,a.kt)("p",{parentName:"admonition"},"The design goal of TypeGraphQL Prisma integration is to generate all the building blocks that you can then use to quickly build your domain logic using custom resolvers."),(0,a.kt)("p",{parentName:"admonition"},"However, it can also generate some resolvers which might be handy especially on the prototyping phase or on the early stage, when the customization options are not limiting yet.")),(0,a.kt)("h2",{id:"crud-resolvers"},"CRUD resolvers"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"typegraphql-prisma")," generator also can emit CRUD resolvers. The API is almost 1:1 matching with the ",(0,a.kt)("inlineCode",{parentName:"p"},"PrismaClient")," API and supports this following methods with their args:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"findUnique"),(0,a.kt)("li",{parentName:"ul"},"findFirst"),(0,a.kt)("li",{parentName:"ul"},"findMany"),(0,a.kt)("li",{parentName:"ul"},"create"),(0,a.kt)("li",{parentName:"ul"},"createMany"),(0,a.kt)("li",{parentName:"ul"},"createManyAndReturn"),(0,a.kt)("li",{parentName:"ul"},"update"),(0,a.kt)("li",{parentName:"ul"},"updateMany"),(0,a.kt)("li",{parentName:"ul"},"delete"),(0,a.kt)("li",{parentName:"ul"},"deleteMany"),(0,a.kt)("li",{parentName:"ul"},"upsert"),(0,a.kt)("li",{parentName:"ul"},"aggregate"),(0,a.kt)("li",{parentName:"ul"},"groupBy")),(0,a.kt)("p",null,"An example of a crud resolver file content:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=generated/type-graphql/resolvers/crud/User/UserCrudResolver.ts",title:"generated/type-graphql/resolvers/crud/User/UserCrudResolver.ts"},"@TypeGraphQL.Resolver(_of => User)\nexport class UserCrudResolver {\n  @TypeGraphQL.Query(_returns => [User], {\n    nullable: false,\n  })\n  async users(\n    @TypeGraphQL.Ctx() ctx: any,\n    @TypeGraphQL.Info() info: GraphQLResolveInfo,\n    @TypeGraphQL.Args() args: FindManyUserArgs,\n  ): Promise<User[]> {\n    const { _count } = transformFields(graphqlFields(info as any));\n    return getPrismaFromContext(ctx).user.findMany({\n      ...args,\n      ...(_count && transformCountFieldIntoSelectRelationsCount(_count)),\n    });\n  }\n\n  @TypeGraphQL.Mutation(_returns => User, {\n    nullable: false,\n  })\n  async createUser(\n    @TypeGraphQL.Ctx() ctx: any,\n    @TypeGraphQL.Info() info: GraphQLResolveInfo,\n    @TypeGraphQL.Args() args: CreateUserArgs,\n  ): Promise<User> {\n    const { _count } = transformFields(graphqlFields(info as any));\n    return getPrismaFromContext(ctx).user.create({\n      ...args,\n      ...(_count && transformCountFieldIntoSelectRelationsCount(_count)),\n    });\n  }\n\n  // more methods goes here...\n}\n")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"By default, the method names will be mapped to a GraphQL idiomatic ones (like ",(0,a.kt)("inlineCode",{parentName:"p"},"findManyUser")," -> ",(0,a.kt)("inlineCode",{parentName:"p"},"users"),")."),(0,a.kt)("p",{parentName:"admonition"},"You can opt-in to use original names by providing ",(0,a.kt)("inlineCode",{parentName:"p"},"useOriginalMapping = true")," generator option.")),(0,a.kt)("h2",{id:"relations-resolvers"},"Relations resolvers"),(0,a.kt)("p",null,"TypeGraphQL Prisma integration also generates resolvers that are resolving the relations between Prisma models.\nThanks to that, you don't need to write any field resolvers by yourself in order to register relation fields in GraphQL schema."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=generated/type-graphql/resolvers/relations/User/UserRelationsResolver.ts",title:"generated/type-graphql/resolvers/relations/User/UserRelationsResolver.ts"},"@TypeGraphQL.Resolver(_of => User)\nexport class UserRelationsResolver {\n  @TypeGraphQL.FieldResolver(_type => [Post], {\n    nullable: false,\n  })\n  async posts(\n    @TypeGraphQL.Root() user: User,\n    @TypeGraphQL.Ctx() ctx: any,\n    @TypeGraphQL.Args() args: UserPostsArgs,\n  ): Promise<Post[]> {\n    return getPrismaFromContext(ctx)\n      .user.findUnique({\n        where: {\n          id: user.id,\n        },\n      })\n      .posts(args);\n  }\n}\n")),(0,a.kt)("p",null,"The generated relation resolvers also supports providing arguments that allows you to filter, sort and paginate over the relation list items."),(0,a.kt)("h2",{id:"bootstrapping"},"Bootstrapping"),(0,a.kt)("p",null,"The fastest way to expose all Prisma CRUD actions is to import ",(0,a.kt)("inlineCode",{parentName:"p"},"resolvers")," from the output folder and just use it in the ",(0,a.kt)("inlineCode",{parentName:"p"},"buildSchema")," function known from TypeGraphQL:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:"{1,4}","{1,4}":!0},'import { resolvers } from "@generated/type-graphql";\n\nconst schema = await buildSchema({\n  resolvers,\n  validate: false,\n});\n')),(0,a.kt)("p",null,"With this approach you will emit all CRUD actions and model relations in the schema."),(0,a.kt)("p",null,"If you need more control, you can import the ",(0,a.kt)("inlineCode",{parentName:"p"},"crudResolvers")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"relationResolvers")," arrays separately:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'import { crudResolvers, relationResolvers } from "@generated/type-graphql";\n')),(0,a.kt)("p",null,"to even transform them dynamically (e.g. excluding all with ",(0,a.kt)("inlineCode",{parentName:"p"},"User")," in name)."),(0,a.kt)("h2",{id:"context-configuration"},"Context configuration"),(0,a.kt)("p",null,"When using the generated resolvers, you have to first provide the ",(0,a.kt)("inlineCode",{parentName:"p"},"PrismaClient")," instance into the context under ",(0,a.kt)("inlineCode",{parentName:"p"},"prisma")," key, to make it available for the crud and relations resolvers."),(0,a.kt)("p",null,"Below you can find an example using Apollo Server V4:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:"{5,11}","{5,11}":!0},'import { PrismaClient } from "@prisma/client";\nimport { ApolloServer } from "@apollo/server";\nimport { startStandaloneServer } from "@apollo/server/standalone";\n\nconst prisma = new PrismaClient();\n\nconst server = new ApolloServer<MyContext>({\n  schema, // from previous step\n});\nconst { url } = await startStandaloneServer(server, {\n  context: () => ({ prisma }),\n  listen: { port: 4000 },\n});\n')),(0,a.kt)("p",null,"But you can also use any other GraphQL server library, like ",(0,a.kt)("inlineCode",{parentName:"p"},"graphql-yoga")," v3:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:"{3,7}","{3,7}":!0},'import { PrismaClient } from "@prisma/client";\n\nconst prisma = new PrismaClient();\n\nconst yoga = createYoga<{}, MyContext>({\n  schema, // from previous step\n  context: () => ({ prisma }),\n});\n')))}m.isMDXComponent=!0}}]);